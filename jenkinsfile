pipeline{
    agent{
        docker { 
            image 'my-light-dev-tools-all' 
            args '--privileged'
        }
        
    }

    environment{
        appsurl = "github.com/edwinmalihu/customer-service-fly.git"
    }

    stages{
        stage("Clone Source"){
            steps{
                script{
                    cleanWs()
                    withCredentials([string(credentialsId: 'token-github', variable: 'GITHUB_TOKEN')]) {
                        sh """
                            git clone --branch main https://oauth2:${GITHUB_TOKEN}@$appsurl 
                        """
                    }  
                }
            }
        }

        stage("Build & Push Image"){
            steps{
                script{
                    echo "Build Image"
                }
            }
        }

        stage("Deploy To Fly.io"){
            steps{
                script{
                    sh "fly version"
                    echo "Deploy Service"
                }
            }
        }
    }
}